---
layout: post
title:  zk 学习
categories: linux
tags: zk
author: CherieLi
---

* content
{:toc}
ZooKeeper是一个开源的的分布式服务框架。主要用来解决分布式应用中经常遇到的，如：统一命名服务、状态同步服务、集群管理、分布式应用配置项的管理等。

在ZooKeeper集群中，每个节点共有3种角色和4种状态：

l  角色： leader，follower，observer

l  状态： leading，following，observing，looking

同一时刻ZooKeeper集群中只会有一个leader,其他的都是follower和observer。Observer不参与投票，默认情况下ZooKeeper中只有leader和follower两个角色。

 

“过半存活即可用”，整个集群如果对外要可用的话，那么集群中必须要有过半的机器是正常工作并且彼此之间能够正常通信。基于这个特性，那么如果想搭建一个能够允许F台机器down掉的集群，那么就要部署一个由2xF+1 台机器构成的ZK集群。



默认ZK是不会自动清理快照和事务日志，需要交给管理员自己来处理。

ZK使用log4j作为日志系统。



#### zk的配置文件：zoo.cfg

server.A=B:C:D

其中A是一个数字，代表服务器编号，也是myid文件里面的值。集群中每台服务器编号都必须唯一，所以要保证每台服务器中的myid文件中的值不同。

B代表服务器的IP地址

C表示服务器与集群中leader服务器交换信息的端口

D表示选举时服务器相互通信的端口

myid这个文件只包含一个数字，和server id对应。

#### 常用命令

##### 1.查询zk状态，判断主/备zk

```shell
sh zkServer.sh all_zk_status
```

##### 2.拉起zk进程

```shell
sh zkServer.sh start
```

##### 3.连接zk集群

```shell
sh zkCli.sh -server ip:port，其中ip为server端ip，port为ip对应端口
```

ip,port可以从配置文件中获取。



##### 参考链接

https://zookeeper.apache.org/doc/r3.6.3/zookeeperTools.html

https://www.cnblogs.com/andy6/p/7674028.html

https://blog.csdn.net/weixin_36586120/article/details/120428292

<http://logging.apache.org/log4j/1.2/manual.html#defaultInit>

ZooKeeper----Client端

http://www.cnblogs.com/ggjucheng/p/3376548.html

ZooKeeper 通信模型

https://www.cnblogs.com/ggjucheng/p/3376568.html